{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
  <!-- Toaster -->
  <link rel="stylesheet" href="{% static 'plugins/toastr/toastr.min.css' %}">
  <title>Login</title>
</head>
<body style="background-color:#f4f6f9">
<!-- Form -->
<div class="container min-vh-100 d-flex justify-content-center align-items-center">
  <div class="card p-2" style="width: 20rem">
    <form id="login-form" method="post" novalidate="novalidate" autocomplete="off">
      {% csrf_token %}
      {% for field in form %}
        <div class="form-group">
          <label for="{{ field.id_for_label }}" class="font-weight-normal">{{ field.label }}</label>
          {{ field }}
        </div>
      {% endfor %}
      <button id="submit-button" type="submit" class="btn btn-primary btn-block">Submit</button>
    </form>
  </div>
</div>
</body>
<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'plugins/toastr/toastr.min.js' %}"></script>
<script src="{% static 'plugins/jquery-validation/jquery.validate.min.js' %}"></script>
<script src="{% static 'plugins/jquery-validation/additional-methods.min.js' %}"></script>
<!-- Toast appearance -->
<script>
  {% if messages %}
    toastr.options = {
      "positionClass": "toast-bottom-left",
      "closeButton": true
    }
    {% for message in messages %}
      toastr.error("{{message}}")
    {% endfor %}
  {% endif %}
</script>
<!-- Proper validation of Email -->
<script>
  jQuery.validator.addMethod("validate_email", function (value, _) {
    return /^([a-zA-Z0-9_.\-])+@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value);
  }, "Please enter a valid email");
</script>
<!-- Form validation -->
<script>
  $(document).ready(function () {
    const $form = $('#login-form');
    const $button = $('#submit-button');

    $form.on('blur keyup change', 'input', function () {
      validateForm();
    });

    const validateForm = function () {
      const isValid = $form.validate({
        rules: {
          email: {
            required: true,
            validate_email: true,
          },
          password: {
            required: true,
            minlength: 6,
            maxlength: 30
          }
        },
        messages: {
          email: {
            required: "Please enter an email",
            email: "Please enter a valid email"
          },
          password: {
            required: "Please provide a password",
            minlength: "Your password must be at least 5 characters long",
            maxlength: "Your password must be at most 30 characters long",
          }
        },
        errorElement: 'small',
        errorPlacement: function (error, element) {
          error.addClass('text-danger ml-1');
          element.closest('.form-group').append(error);
        },
        highlight: function (element) {
          $(element).addClass('is-invalid');
        },
        unhighlight: function (element) {
          $(element).removeClass('is-invalid');
        }
      }).checkForm();
      if (isValid) {
        $button.prop('disabled', false);
      } else {
        $button.prop('disabled', 'disabled');
      }
    }
  })
</script>
</html>
